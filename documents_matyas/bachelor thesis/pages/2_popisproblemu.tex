\chapter{Popis problému a specifikace cíle}
\section{Popis problematiky}

Softwarový systém má sloužit člověku k řešení problémů. Uživatel přitom často problém blíže specifikuje a systém musí mít způsob, jak uživateli sdělit jeho řešení. K tomu slouží uživatelská rozhraní, která umožňují vzájemnou komunikaci systému s uživatelem. Takové uživatelské rozhraní by mělo v prní řadě sloužit uživateli, to znamená umožnit mu jednoduchou interakci se systémem, být intuitivní, funkční a hlavně použitelné. 


\subsection{Různá uživatelská rozhraní}
Aby bylo uživatelské rozhraní použitelné a uživatelsky přívětivé je třeba prozkoumat, jakým způsobem člověk s počítačem a jeho aplikacemi spolupracuje. Nejen tímto se zabývá disciplína zvaná Human Computer Interaction, která zkoumá potřeby uživatelů z různorodých hledisek. Studium uživatelských potřeb vedlo ke vzniku různých uživatelských rozhraní, pomocí kterých může člověk s počítačem komunikovat. Jedním z takových rozhraní je textové uživatelské rozhraní, značené CUI, jehož typickým zástupcem je příkazová řádka. Dalším typem je Hlasové uživatelské rozhraní, které dokáže interpretovat povely zadané lidskou řečí.  Nezanedbatelným zástupcem je taktéž multimodální rozhraní, které používá k interakci s počítačem více lidských smyslů, a tak je vhodné i pro lidi s postižením. Nejrozšířenějším a nejoblíbenějším rozhraním je však grafické uživatelské rozhraní, zkráceně GUI, protože je jednoduché a grafické prvky v člověku vyvolávají podobnost s vnějším světem, čímž uživatel získává pocit, že pracuje s něčím, co už dávno zná. Také není nutné znát žádně specifické příkazy, jako v případě příkazové řádky, nebo hlasové povely jako v případě hlasového rozhraní. \cite{uiTypes}. 

V softwarových systémech je nejběžnějsím způsobem interakce uživatele se systémem právě grafické uživatelské rozhraní a tím se taky tato práce bude zabývat. 

Běžně GUI disponuje ovládacími prvky, pomocí kterých lze aplikaci ovládat. V mobilních aplikacích jsou ovládacími prvky nejčastěji tlačítka, menu, formuláře, posuvníky či seznamy položek. Formulář je skupina vstupních polí, která zachycují uživatelský vstup neboli grafické prvky, které umožní uživateli zadat text, zaškrtnout či vybrat z více možností, vybrat datum atd. Formulář a seznam položek může být aplikací využit také k zobrazení svého výstupu, respektive aktuálního stavu systému, který musí být uživateli k dispozici, neboť účelem GUI je i mimo jiné informovat uživatele o výsledku jeho akcí a dopadu akcí na systém. K zobrazení informací uživatelovi dále slouží statické texty, tabulky, dialogy. 

Návrh GUI je potřeba důkladně zvážit, neboť závisí na mnoha aspektech. Důležité je, pro jaké zařízení je GUI tvořeno, jaký účel má aplikace, která bude rozhraním disponovat a stav uživatele a prostředí, ve kterém se nachází. 

Typ zařízení je důležitý hlavně proto, protože každé zařízení používá jiné ovládací prvky. Zatímco u mobilního zařízení lze očekávat použití dotykového displeje, u počítače zase použití myši, klávesnice nebo i jiných externích vstupních zařízení, například grafický tablet. Taky se zařízení liší ve velikosti displeje a rozlišení, což hraje roli zejména při návrhu GUI z hlediska množství, velikosti a rozložení komponent.

Účel aplikace ovlivňuje GUI hlavně z hlediska obsahu, tedy jaké komponenty je nutné mít, aby byla aplikace využívána k daném účelu. Například emailový klient musí obsahovat ovládací prvek, který odešle zprávu. 

Stav uživatele a prostředí může zase ovlivnit způsob ovládání aplikace. Příkladem může být palubní počítač v automobilu, na kterém by měl uživatel být schopen přepnout rádiovou stanici, aniž by se přestal věnovat řízení. 


\subsection{Tvorba uživatelského rozhraní}

Je známo, že vývojáři vkládají do tvorby uživatelského rozhraní velké úsilí a značné množství času, což dokazuje i zjištění, že uživatelské rozhraní zabírá přibližně 48\% kódu aplikace a zhruba 50\% času, který je vývoji aplikace věnován \cite{towards-smart-design}. Další čas a úsilí také zabere testování rozhraní hlavně z hlediska použitelnosti, které opět stojí spoustu času i nákladů. Vývojář mnohdy nedokáže odhadnout chování cílové skupiny, která systém bude používat, a tak se často dělají testy s koncovým uživatelem, u kterých se zkoumá, jak uživatel software ovládá. Z těchto testů se často odhalí, že uživatelské rozhraní je nedostačující a neposkytuje uživateli potřebný komfort při ovládání systému. Velkým problémem je uživatelský vstup, protože musí být validován, aby uživatel nevložil data, která jsou v rozporu s modelem, na který je rozhraní namapováno \cite{cernyTEA}. Také je žádoucí zobrazovat uživateli pouze to, co by vidět měl, například na základě jeho uživatelské role v systému. V neposlední řadě je také podstatné, jak rozhraní vypadá. Důležitým aspektem rozhraní je, jakým způsobem jsou v něm reprezentována data a jak jsou uspořádány jeho jednotlivé části. Z výše uvedeného lze vidět, že je tvorba uživatelského rozhraní opravdu náročný a rozsáhlý proces a právě proto je poskytovat pro systém více verzí uživatelských rozhraní, například pro různé platformy nebo pro různé uživatelské role, obtížný úkol \cite{cernyTEA}.

Jedním z hlavních a kritických aspektů dobrého softwaru jeho udržovatelnost, anglicky maintainability. Udržovatelnost je schopnost systému se dále měnit a vyjívet na základě požadavků zákazníka. Změny by přitom měly být lehce proveditelné a něměly by nijak výrazně ovlivnit stav systému. Požadavky na změnu lze očekávat vždy, neboť potřeby zákazníků se neustále mění \cite{sommerville}. Bohužel uživatelské rozhraní moc udržovatelné není, což ukáže následující příklad.

Mějme například desktopovou a mobilní aplikaci, které obě obsahují formulář namapovaný na určitou entitu v databázovém modelu. Tento model se nějak změní, například v dané entitě rozdělíme jeden sloupec na dva. Bohužel neexistuje žádný machanismus, který by automaticky zaručil, že je UI v souladu s modelem \cite{cernyTEA}. Z pohledu vývojáře to pak znamená, že pokud změní databázový model, musí také změnit uživatelské rozhraní v obou klientských aplikacích, aby korespondovalo s novým databázovým modelem. Zde nejenom, že musí vývojář udělat dvakrát stejnou věc, ale také může udělat chybu, což může vyústit v nefunkčnost systému. Také pokud se takový formulář vyskytuje třeba na pěti místech v aplikaci, změna je už časově náročnější, hůře proveditelná a ještě více náchylná na chybu vývojáře, který může nějaký výskyt formuláře opomenout.
Takovým zásahem do systému nemusí být jen změna databázového modelu, ale také změna validací uživatelského vstupu nebo změna rozložení či pořadí jednotlivých polí ve formuláři.

\subsection{Využití webových služeb pro zisk a odeslání dat}
Jak už bylo zmíněno, v grafickém uživatelském rozhraní máme výstupní grafické prvky, jako například tabulky či seznamy položek. Tyto komponenty jsou určeny v první řadě k tomu, aby zobrazovaly uživateli soubor dat. Existuje více možností, kde tato data skladovat a odtud je získávat a prezentovat je uživateli. Jednou z možností je, že má aplikace vlastní databázi. Taková aplikace není určena k tomu, aby komunikovala nebo sdílela data s dalšími instancemi této aplikace na jiných zařízeních. Pokud je komunikace vyžadována, je vhodná architektura klient-server. Server může mít vlastní databázi, ze které poskytuje klientům informace například prostřednictvím webových služeb. Webová služba umožňuje jednomu zařízení interakci s jiným zařízením prostřednictvím sítě\cite{wiki-ws}. V tomto případě je jedním zařízením server, druhým klienstká aplikace a interakcí je myšlen vzájemný přenos dat. 

V mobilních aplikacích jsou velmi populární interpretací webových služeb RESTful Web Services využívající Representional State Transfer (REST), který byl navržen tak, aby získával data ze zdrojů pomocí jednotných identifikátorů zdrojů (URI), což jsou typicky odkazy na webu. Využívá se právě v aplikacích s klient-server architekturou a ke komunikaci používá HTTP protokol, jehož výhodou je, že jeho metody poskytují jednotné rozhraní pro manipulaci se zdroji informací poskytovanými webovou službou. Http metoda PUT se využívá k vytvoření nového zdroje, DELETE zdroj maže, GET se používá pro získání aktuálního stavu zdroje v nějaké dané reprezentaci a POST stav zdroje upravuje \cite{oracle-ws}. 

Aby klient mohl data z webové služby získat a následně je reprezentovat v UI, musí znát jejich strukturu, formát dat, metodu, kterou musí použít a dodatečné parametry, kterými lze službu nastavit. Data jsou ve spojitosti s RESTful službami nejčastěji přenášena ve formě XML nebo alternativně ve formě JSON\cite{ws-formats}, což jsou formáty obsahující data ve formě párů klíč - hodnota. Zmíněné formy dat vzikají serialializací objektů \cite{serialization}, jejichž definici lze většinou získat z dokumentace poskytovatele webové služby, stejně tak jako další potřebné výše zmíněné věci.

Přijatá data lze na klientovi zpracovat více způsoby. Jednou z možností je napsat si vlastní parser, což si lze usnadnit nějakou knihovnou, která s formátem umí pracovat. Pro formát JSON v Javě existuje například knihovna org.json \cite{json}. Dalším způsobem je využítí nějaké knihovny, která umí data rovnou deserializovat do objektu. Příkladem takové knihovny je Gson\cite{gson}. 

Obdobně webové služby fungují i v případě odesílání dat. Zdroj webové služby definuje v jakém formátu data přijme a v dokumentaci lze opět nalézt definici objektu, do kterého se bude snažit data deserializovat, respektive přijatá data vložit. 

Z uvedeného plyne, že se klientská aplikace musí v obou situacích, jak při zisku, tak při odesílání dat, adaptovat na určitou, předem danou strukturu dat. Pokud se tato struktura změní, tedy změní se objekt ze kterého serializací data vznikají a deserializují se \cite{serialization} do něj odeslaná data, je nutné upravit i příslušná místa v klienstké aplikaci, která zpracování a odesílání uživatelského vstupu mají nastarosti.  

Demostrujeme problém na příkladě. Máme server a na něm model naříklad Tým, který obsahuje dva sloupce - název týmu a počet členů. Vytvoříme si klienstkou aplikaci, která tato data získá a zobrazí, například v tabulce. Nyní se rozhodneme, že by měl přibýt v modelu sloupec, obsahující zkratku týmu. 

Nejdříve na to nahlédname z pohledu zisku dat. Upravíme-li model na serveru, v datech, která jsou poskytována webovou službou, přibude další hodnota. Proto je nutné upravit klientskou aplikaci, aby s těmito dodatečnými daty počítala a rovněž je zobrazila v tabulce. Pokud se však rozhodneme, že se nějaký sloupec odstraní, je situace o trochu složitější. Po získání dat nám na klientovi hodnota bude chybět. Pokud  je nad hodnotou prováděna nějaká operace a klient není správně ošetřený, může to vyústit i v pád aplikace.

Nyní budeme data posílat. Server může určovat, které hodnoty vyžaduje. Pokud tedy přidáme novou hodnotu, kterou server označí jako povinnou, bude pokus neupraveného klienta zaslat data neúspěšný, neboť je server odmítne. Opět je nutné upravit tak, aby bylo možné novou hodnotu zadat, to znamená přidat nové vstupní pole a upravit parser, či objekt, ze kterého se data připravují serializací na odeslání. Nastane-li odstranění nějakého sloupce z modelu na serveru, bude to pro klienta opět problém, protože bude zasílat data obsahující hodnotu, kterou server nezná a ten data opět odmítne a znovu je nutné klienta upravit. 

Pokaždé, kdy jsou provedeny úpravy v klienstké aplikaci, se musí vydat její nová verze. Bohužel v dnešní době je možnost aktualizaci neprovést, a to hlavně na mobilních zařízeních, příkladem může být Google Play na Androidu \cite{android-auto-update}. Když se aplikace neaktualizuje, uživatel může mít nefunkční aplikaci nebo může nastat chyba na serveru, záleží na provedené změně. Tento problém se řeší například podmínkami na verzi aplikace nebo vynucením aktualizace při startu aplikace. Výše zmíněný problém by byl eliminován, pokud by server klienta informoval o tom, co vyžaduje a klient by se dynamicky těmto potřebám přizpůsobil, aniž by musela být klienská část jakkoliv upravována.

\subsection{Existující řešení}
Tato sekce popisuje existující řešení pro mobilní aplikace, která se snaží o řešení výše uvedených problémů. Jedno řešení nabízí vývojáři z IBM developerWorks ve svém článku Build dynamic user interfaces with Android and XML \cite{dynamic-android-xml}. Článek popisuje možnost dynamického vytvoření formuláře z XML souboru pro Android aplikace. Podle návodu aplikace stáhne z URL adresy určitý XML soubor, ve kterém je nadefinována struktura formuláře. Návod dále ukazuje, jak stažené XML parsovat a dynamicky vytvořit na jeho základě v aplikaci formulář. Tento způsob formulář centralizuje, tedy pokud se formulář vyskytuje na více místech v aplikaci a je třeba ho změnit, stačí upravit daný XML soubor.

Dalším řešením je projekt AFSwinx společně s AFRest \cite{tomasek-thesis}, který uvedený princip rozšiřuje o to, že se popis formuláře automaticky generuje z modelu na serveru a klient tento popis získává pomocí webových služeb. Tento framework však není určen pro mobilní aplikace, nýbrž pro Java SE platformu. AFSwinx a AFRest vycházejí z AspectFaces \cite{aspect-faces}, který  uvedené problémy řeší v Java EE aplikacích.

\subsubsection{PHP Database Form}
PHP Database Form \cite{phpdbform} je rozšíření pro jazyk PHP. Toto rozšíření dokáže automaticky z modelu v databázi vytvořit HTML kód formuláře, včetně validací jednotlivých polí. Umožňuje vybrat pro vytvoření pouze některou část tabulky a to pomocí SQL dotazu. Dále pak poskytuje možnost dodatečných nastavení názvů polí, jejich viditelnosti či způsobu zobrazení. Lze také dodat validace tam, kde nebyly určeny databázovým modelem. Hlavními výhodami tohoto rozšíření jsou: menší množství kódu, jednoduché validování dat a možnost upravit si formulář dle libosti pomocí CSS. Využití vyžaduje PHP verzi 5.3 a Apache, Tomcat nebo Microsoft IIS web server. PHP Database Form podporuje všechny majoritně využívané databáze a webové prohlížeče. Dnes už by se i toto rozšíření dalo použít pro mobilní aplikace, neboť existují možnosti vytvářet multiplatformní mobilní aplikace pomocí HTML, CSS a JavaScriptu, které spouští aplikaci na mobilním zařízení v režimu webového prohlížeče. Takovou možností je například Apache Cordova \cite{apache-cordova}.

\subsubsection{AspectFaces}
AspectFaces je framework, který se snaží o to, aby bylo UI generováno na základě modelu \cite{aspectdriven}, k čemuž využívá inspekci tříd. To umožní nadefinovat UI pouze jednou a veškeré změny v modelu jsou automaticky do uživatelského rozhraní reflektovány. UI lze nadefinovat v modelu pomocí velkého množství anotací z JPA, Hibernate nebo si lze nadefinovat i anotace vlastní. Lze určit například pravidla pro dané pole, pořadí v UI nebo label. Framework zatím poskytuje dynamickou integraci pouze s JavaServer Faces 2.0, ale pracuje se na integraci i s jinými technologiemi. Poslední stabilní verze frameworku je 1.4.0 a je dostupný pod licencí LGPL v3.

\subsubsection{AFSwinx a AFRest}
Tento framework byl vytvořen jako koncept a slouží pro generování uživatelského rozhraní v Java SE aplikacích využívajících pro tvorbu UI knihovnu Swing \cite{tomasek-thesis}. Framework používá RESTful webové služby pro zisk definic komponent, díky kterým je schopen dynamicky postavit formulář či tabulku. Takové definice komponent vznikají za pomocí části frameworku AFRest, která ke generování dat využívá inspekce příslušného modelu na serveru, na který by měla být komponenta namapována. Jelikož se tvoří komponenta na základě tohoto modelu, nenastane tak, že by s ním nebyla v souladu. Inspekci tříd zprostředkovává knihovna AspectFaces, uvedená výše. Definice komponenty je přenášena ve formátu JSON a obsahuje informace o komponentě, například její rozložení, pole, které má obsahovat nebo pravidla, která pro jednotlivíá pole platí. Pole z definice se v případě formuláře interpretuje jako vstupní políčko, v případě tabulky jako sloupec. 

\subsection{Cíle práce}
Vzorem pro tento projekt je výše zmíněný framework AFSwinx spolu s AFRest\cite{tomasek-thesis}. Framework se snaží o zjednodušení tvorby uživatelských rozhraní hlavně z hlediska množství kódu a udržovatelsnosti. Jak bylo popsáno, framework na straně serveru využívá inspekce tříd k vytvoření definice modelu, které poskytuje klientovi pomocí webových služeb, stejně tak jako data, kterými se má budoucí komponenta naplnit. Klient tyto informace pouze získává a interpretuje je, nemá tedy informaci o celém procesu tvorby komponenty, zná pouze nutné informace jako je formát dat, například JSON, XML a připojení na zdroje webových služeb, ze kterých data získává. Na vytvoření komponenty stačí klientovi pouze pár řádků kódu. Cílem této práce je vytvořit obdobný framework pro mobilní platformy Android a Windows Phone. Žádoucí je také některé prvky z AFSwinx a AFRest znovupoužít a případně přinést do stávajícího frameworku i něco navíc.
